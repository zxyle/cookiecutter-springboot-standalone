// This project was generated by {{ cookiecutter.author_name }} at {% now 'local', '%Y-%m-%d %X' %}.
// The version of generator is v{{ cookiecutter._version }}.

package {{ cookiecutter.basePackage }}.biz.sys.controller;

import cn.hutool.system.SystemUtil;
import {{ cookiecutter.basePackage }}.biz.sys.response.JvmResponse;
import {{ cookiecutter.basePackage }}.common.response.R;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.lang.management.ManagementFactory;
import java.lang.management.RuntimeMXBean;

/**
 * 服务管理
 */
@RestController
@RequestMapping("/sys")
public class JvmController {

    /**
     * 获取JVM信息
     */
    @PreAuthorize("@ck.hasPermit('sys:jvm:get')")
    @GetMapping("/jvm")
    public R<JvmResponse> get() {
        JvmResponse jvmResponse = new JvmResponse();
        jvmResponse.setProcessId(getProcessID());
        System.out.println(SystemUtil.getJvmSpecInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getJvmInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getJavaSpecInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getJavaInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getJavaRuntimeInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getOsInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getUserInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getHostInfo());
        System.out.println("------------------");
        System.out.println(SystemUtil.getRuntimeInfo());
        return R.ok(jvmResponse);
    }


    // 获取进程ID
    public static int getProcessID() {
        RuntimeMXBean runtimeMXBean = ManagementFactory.getRuntimeMXBean();
        return Integer.parseInt(runtimeMXBean.getName().split("@")[0]);
    }


}

// This project was generated by {{ cookiecutter.author_name }} at {% now 'local', '%Y-%m-%d %X' %}.
// The version of generator is v{{ cookiecutter._version }}.

package {{ cookiecutter.basePackage }}.biz.sdk.controller;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import {{ cookiecutter.basePackage }}.biz.sdk.entity.OpenApi;
import {{ cookiecutter.basePackage }}.biz.sdk.service.IOpenApiService;
import {{ cookiecutter.basePackage }}.common.request.PaginationRequest;
import {{ cookiecutter.basePackage }}.common.response.PageVO;
import {{ cookiecutter.basePackage }}.common.response.R;
import {{ cookiecutter.basePackage }}.common.util.EntityUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;

/**
 * 开放接口管理
 */
@RestController
@RequestMapping("/auth")
@RequiredArgsConstructor
public class OpenApiController {

    final IOpenApiService thisService;

    /**
     * 开放接口分页查询
     */
    @PreAuthorize("@ck.hasPermit('auth:openApi:list')")
    @GetMapping("/openApis")
    public R<PageVO<OpenApi>> page(@Valid PaginationRequest req) {
        QueryWrapper<OpenApi> wrapper = new QueryWrapper<>();
        wrapper.orderBy(EntityUtil.getFields(OpenApi.class).contains(req.getField()),
                req.isAsc(), req.getField());
        IPage<OpenApi> page = thisService.page(req.toPageable(), wrapper);
        return R.page(page);
    }


    /**
     * 新增开放接口
     */
    @PreAuthorize("@ck.hasPermit('auth:openApi:add')")
    @PostMapping("/openApis")
    public R<OpenApi> add(@Valid @RequestBody OpenApi entity) {
        boolean success = thisService.save(entity);
        return success ? R.ok(entity) : R.fail("新增失败");
    }


    /**
     * 按ID查询开放接口
     */
    @PreAuthorize("@ck.hasPermit('auth:openApi:get')")
    @GetMapping("/openApis/{id}")
    public R<OpenApi> get(@PathVariable Integer id) {
        OpenApi entity = thisService.findById(id);
        return entity == null ? R.fail("数据不存在") : R.ok(entity);
    }


    /**
     * 按ID更新开放接口
     */
    @PreAuthorize("@ck.hasPermit('auth:openApi:update')")
    @PutMapping("/openApis/{id}")
    public R<Void> update(@Valid @RequestBody OpenApi entity, @PathVariable Integer id) {
        entity.setId(id);
        boolean success = thisService.updateById(entity);
        return success ? R.ok("更新成功") : R.fail("更新失败");
    }


    /**
     * 按ID删除开放接口
     */
    @PreAuthorize("@ck.hasPermit('auth:openApi:delete')")
    @DeleteMapping("/openApis/{id}")
    public R<Void> delete(@PathVariable Integer id) {
        boolean success = thisService.removeById(id);
        return success ? R.ok("删除成功") : R.fail("删除失败");
    }

}

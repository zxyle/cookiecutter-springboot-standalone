// This project was generated by {{ cookiecutter.author_name }} at {% now 'local', '%Y-%m-%d %X' %}.
// The version of generator is v{{ cookiecutter._version }}.

package {{ cookiecutter.basePackage }}.biz.auth.service.impl;

import {{ cookiecutter.basePackage }}.biz.auth.service.ShortMessageService;
import {{ cookiecutter.basePackage }}.biz.sys.entity.Verification;
import {{ cookiecutter.basePackage }}.biz.sys.service.IVerificationService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;

/**
 * 短信发送服务伪实现
 */
@Slf4j
@Service
public class PseudoShortMessageServiceImpl implements ShortMessageService {

    @Value("${app.name}")
    private String appName;

    IVerificationService verificationService;

    public PseudoShortMessageServiceImpl(IVerificationService verificationService) {
        this.verificationService = verificationService;
    }

    /**
     * 发送验证码短信
     *
     * @param recipient 手机号
     * @param code      验证码
     */
    @Async
    @Override
    public void send(String recipient, String code) {
        String template = "【%s】验证码：%s，5分钟内有效，为了保障您的账户安全，请勿向他人泄漏验证码信息";
        String content = String.format(template, appName, code);
        log.info(content);

        // 记录短信验证码发送记录
        Verification verification = new Verification();
        verification.setKind("mobile");
        verification.setReceiver(recipient);
        verification.setContent(content);
        verificationService.save(verification);
    }
}
